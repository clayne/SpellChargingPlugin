<title>Creating your first plugin</title>
<link rel="stylesheet" href="styles/vs.css">
<script src="highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<h1>Creating your first plugin</h1>
<h2>Setting up the project in Visual Studio</h2>
<p>Step 1: In visual studio select "New Project" under your chosen .NET language and make sure it's a DLL file type. For these tutorials I will be using C# and Skyrim Special Edition game as an example.</p>
<p>Step 2: Once you have the project select "References->Add Reference->Browse" and select the two files called "NetScriptFramework.dll" and "NetScriptFramework.Skyrim.dll", if you are working on a game without a type library or you don't need to use the type library then the second reference should be skipped.</p>
<p>Step 3: This step is only necessary if you are using C++/CLI and the application is 64-bit - go to "Build->Configuration Manager->Active Solution Platform" and select x64.</p>
<p>Step 4: Create a new class and name it MyTestPlugin (or anything else you like) and make it inherit NetScriptFramework.Plugin class.</p>
<p>Step 5: The class must override three properties called Plugin.Name.get, Plugin.Key.get, Plugin.Version.get, but you will also want to override Plugin.Initialize method. At this point you should have something like this:</p>
<pre><code class="cs">class MyTestPlugin : Plugin
{
	public override string Key
	{
		get
		{
			return "mytest";
		}
	}

	public override string Name
	{
		get
		{
			return "My test plugin";
		}
	}

	public override int Version
	{
		get
		{
			return 1;
		}
	}
	
	protected override bool Initialize(bool loadedAny)
	{
		return true;
	}
}</code></pre>
<p>This is all that is required to get the plugin to load. Try it out by building the project and put the DLL in \Data\NetScriptFramework\Plugins\ directory (or somewhere else if you have modified the path to plugins). Start the application and check the log file, your plugin should have loaded with the following message:</p>
<pre><code class="plaintext">[17 Nov 2018 11:08:35.998] Checking file "MyProjectName.dll"...
[17 Nov 2018 11:08:36.006] Plugin found and loaded.
[17 Nov 2018 11:08:36.019] Finished loading 1 plugin.</code></pre>
<p>If the plugin did not load then check if there's an error message accompanied. If there are no messages and didn't even get "Checking file" part then the plugin DLL was not placed in the correct directory.</p>
<h2>Initializing the plugin</h2>
<p>The only time the framework will do anything with your plugin is when it's being initialized which means that you must either write all your hooks, register for events and do memory edits (depending on what your plugin will do) at that time. If you do nothing in the Initialize function your plugin will never do anything at all. If your plugin depends on another plugin to load first you can return false in the Initialize function to let the framework know you refuse to Initialize just yet, the framework will then try to initialize other plugins first and come back to your plugin. If no plugins initialized during a pass it will call Initialize again with the loadedAny argument set to false. If no plugins still Initialized during that phase the application will say an error and exit. You can check if another plugin is initialized like this:</p>
<pre><code class="cs">Plugin otherPlugin = NetScriptFramework.PluginManager.GetPlugin("keyOfAnotherPlugin");
if (otherPlugin == null) // Other plugin is not installed at all
    return false;
if (!otherPlugin.IsInitialized) // Other plugin is not initialized yet
    return false;
// Other plugin has been initialized already so we can use it.</code></pre>
<p>If you have referenced the other plugin as a dependency then you can also try to cast the other Plugin file to a higher type and use its methods and properties directly.</p>
<p>You should never do initialization or other actions in the constructor of your plugin! It is better to leave all code to the Initialize method and not even declare a constructor.</p>
<p>More about what you can do in the Initialize method will be explained in the following tutorials.</p>
<h2>Releasing the plugin</h2>
<p>When you release the plugin to others you only need to include your plugin's DLL. Do not include the framework files. If your plugin depends on someone else's plugin do not include that either unless you have their permission. Mark it as a requirement instead. If your plugin depends on third party libraries that you have referenced or use with DllImport but aren't plugins themselves they should be in the \Data\NetScriptFramework\Plugins\Lib\ directory. This directory will automatically be searched for any DLLs when resolving dependencies. As an example if your plugin DLL is named MyPlugin.dll and your project has a reference or depends on JSON.NET library then the final contents of your release archive file should be:</p>
<pre><code class="plaintext">\NetScriptFramework\Plugins\MyPlugin.dll
\NetScriptFramework\Plugins\MyPlugin.pdb (optional)
\NetScriptFramework\Plugins\Lib\Newtonsoft.Json.dll
\NetScriptFramework\Plugins\Lib\Newtonsoft.Json.pdb (optional)</code></pre>
<p>Including the debug symbols (PDB file) may be helpful because if there are unhandled exceptions or problems with your plugin your users can post crash logs that will be more helpful to you than without the symbols file.</p>
